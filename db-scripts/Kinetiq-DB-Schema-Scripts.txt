-- For Creation of Schemas 
CREATE SCHEMA IF NOT EXISTS public;
CREATE SCHEMA production;
CREATE SCHEMA project_management;
CREATE SCHEMA mrp;
CREATE SCHEMA human_resources;
CREATE SCHEMA sales;
CREATE SCHEMA services;
CREATE SCHEMA admin;
CREATE SCHEMA management;
CREATE SCHEMA accounting;
CREATE SCHEMA finance;
CREATE SCHEMA purchasing;
CREATE SCHEMA operations;
CREATE SCHEMA inventory;
CREATE SCHEMA distribution;
CREATE SCHEMA solution_customizing;

-- Schema owners will be the database team (postgres) since we'll be the one handling 
-- all the permissions and modifications of schemas and tables
ALTER SCHEMA production OWNER TO postgres;
ALTER SCHEMA project_management OWNER TO postgres;
ALTER SCHEMA mrp OWNER TO postgres;
ALTER SCHEMA human_resources OWNER TO postgres;
ALTER SCHEMA sales OWNER TO postgres;
ALTER SCHEMA services OWNER TO postgres;
ALTER SCHEMA admin OWNER TO postgres;
ALTER SCHEMA management OWNER TO postgres;
ALTER SCHEMA accounting OWNER TO postgres;
ALTER SCHEMA finance OWNER TO postgres;
ALTER SCHEMA purchasing OWNER TO postgres;
ALTER SCHEMA operations OWNER TO postgres;
ALTER SCHEMA inventory OWNER TO postgres;
ALTER SCHEMA distribution OWNER TO postgres;
ALTER SCHEMA solution_customizing OWNER TO postgres;

-- Grant public usage
GRANT USAGE ON SCHEMA production TO public;
GRANT USAGE ON SCHEMA project_management TO public;
GRANT USAGE ON SCHEMA mrp TO public;
GRANT USAGE ON SCHEMA human_resources TO public;
GRANT USAGE ON SCHEMA sales TO public;
GRANT USAGE ON SCHEMA services TO public;
GRANT USAGE ON SCHEMA admin TO public;
GRANT USAGE ON SCHEMA management TO public;
GRANT USAGE ON SCHEMA accounting TO public;
GRANT USAGE ON SCHEMA finance TO public;
GRANT USAGE ON SCHEMA purchasing TO public;
GRANT USAGE ON SCHEMA operations TO public;
GRANT USAGE ON SCHEMA inventory TO public;
GRANT USAGE ON SCHEMA distribution TO public;
GRANT USAGE ON SCHEMA solution_customizing TO public;

-- Grant privileges to erp_user
GRANT SELECT, INSERT, UPDATE ON ALL TABLES IN SCHEMA production TO erp_user;
GRANT SELECT, INSERT, UPDATE ON ALL TABLES IN SCHEMA project_management TO erp_user;
GRANT SELECT, INSERT, UPDATE ON ALL TABLES IN SCHEMA mrp TO erp_user;
GRANT SELECT, INSERT, UPDATE ON ALL TABLES IN SCHEMA human_resources TO erp_user;
GRANT SELECT, INSERT, UPDATE ON ALL TABLES IN SCHEMA sales TO erp_user;
GRANT SELECT, INSERT, UPDATE ON ALL TABLES IN SCHEMA services TO erp_user;
GRANT SELECT, INSERT, UPDATE ON ALL TABLES IN SCHEMA admin TO erp_user;
GRANT SELECT, INSERT, UPDATE ON ALL TABLES IN SCHEMA management TO erp_user;
GRANT SELECT, INSERT, UPDATE ON ALL TABLES IN SCHEMA accounting TO erp_user;
GRANT SELECT, INSERT, UPDATE ON ALL TABLES IN SCHEMA finance TO erp_user;
GRANT SELECT, INSERT, UPDATE ON ALL TABLES IN SCHEMA purchasing TO erp_user;
GRANT SELECT, INSERT, UPDATE ON ALL TABLES IN SCHEMA operations TO erp_user;
GRANT SELECT, INSERT, UPDATE ON ALL TABLES IN SCHEMA inventory TO erp_user;
GRANT SELECT, INSERT, UPDATE ON ALL TABLES IN SCHEMA distribution TO erp_user;
GRANT SELECT, INSERT, UPDATE ON ALL TABLES IN SCHEMA solution_customizing TO erp_user;

GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA production TO erp_user;
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA project_management TO erp_user;
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA mrp TO erp_user;
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA human_resources TO erp_user;
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA sales TO erp_user;
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA services TO erp_user;
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA admin TO erp_user;
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA management TO erp_user;
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA accounting TO erp_user;
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA finance TO erp_user;
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA purchasing TO erp_user;
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA operations TO erp_user;
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA inventory TO erp_user;
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA distribution TO erp_user;
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA solution_customizing TO erp_user;

-- Ensure future tables get the same privileges
ALTER DEFAULT PRIVILEGES IN SCHEMA production 
GRANT SELECT, INSERT, UPDATE ON TABLES TO erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA project_management 
GRANT SELECT, INSERT, UPDATE ON TABLES TO erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA mrp 
GRANT SELECT, INSERT, UPDATE ON TABLES TO erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA human_resources 
GRANT SELECT, INSERT, UPDATE ON TABLES TO erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA sales 
GRANT SELECT, INSERT, UPDATE ON TABLES TO erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA services 
GRANT SELECT, INSERT, UPDATE ON TABLES TO erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA admin 
GRANT SELECT, INSERT, UPDATE ON TABLES TO erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA management 
GRANT SELECT, INSERT, UPDATE ON TABLES TO erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA accounting 
GRANT SELECT, INSERT, UPDATE ON TABLES TO erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA finance 
GRANT SELECT, INSERT, UPDATE ON TABLES TO erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA purchasing 
GRANT SELECT, INSERT, UPDATE ON TABLES TO erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA operations 
GRANT SELECT, INSERT, UPDATE ON TABLES TO erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA inventory 
GRANT SELECT, INSERT, UPDATE ON TABLES TO erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA distribution 
GRANT SELECT, INSERT, UPDATE ON TABLES TO erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA solution_customizing 
GRANT SELECT, INSERT, UPDATE ON TABLES TO erp_user;

-- Revoke CREATE privilege on each schema for erp_user 
REVOKE CREATE ON SCHEMA production           FROM erp_user;
REVOKE CREATE ON SCHEMA project_management   FROM erp_user;
REVOKE CREATE ON SCHEMA mrp                  FROM erp_user;
REVOKE CREATE ON SCHEMA human_resources      FROM erp_user;
REVOKE CREATE ON SCHEMA sales                FROM erp_user;
REVOKE CREATE ON SCHEMA services             FROM erp_user;
REVOKE CREATE ON SCHEMA admin                FROM erp_user;
REVOKE CREATE ON SCHEMA management           FROM erp_user;
REVOKE CREATE ON SCHEMA accounting           FROM erp_user;
REVOKE CREATE ON SCHEMA finance              FROM erp_user;
REVOKE CREATE ON SCHEMA purchasing           FROM erp_user;
REVOKE CREATE ON SCHEMA operations           FROM erp_user;
REVOKE CREATE ON SCHEMA inventory            FROM erp_user;
REVOKE CREATE ON SCHEMA distribution         FROM erp_user;
REVOKE CREATE ON SCHEMA solution_customizing FROM erp_user;

-- Restrict DELETE operations for erp_user
REVOKE DELETE ON ALL TABLES IN SCHEMA production FROM erp_user;
REVOKE DELETE ON ALL TABLES IN SCHEMA project_management FROM erp_user;
REVOKE DELETE ON ALL TABLES IN SCHEMA mrp FROM erp_user;
REVOKE DELETE ON ALL TABLES IN SCHEMA human_resources FROM erp_user;
REVOKE DELETE ON ALL TABLES IN SCHEMA sales FROM erp_user;
REVOKE DELETE ON ALL TABLES IN SCHEMA services FROM erp_user;
REVOKE DELETE ON ALL TABLES IN SCHEMA admin FROM erp_user;
REVOKE DELETE ON ALL TABLES IN SCHEMA management FROM erp_user;
REVOKE DELETE ON ALL TABLES IN SCHEMA accounting FROM erp_user;
REVOKE DELETE ON ALL TABLES IN SCHEMA finance FROM erp_user;
REVOKE DELETE ON ALL TABLES IN SCHEMA purchasing FROM erp_user;
REVOKE DELETE ON ALL TABLES IN SCHEMA operations FROM erp_user;
REVOKE DELETE ON ALL TABLES IN SCHEMA inventory FROM erp_user;
REVOKE DELETE ON ALL TABLES IN SCHEMA distribution FROM erp_user;
REVOKE DELETE ON ALL TABLES IN SCHEMA solution_customizing FROM erp_user;

ALTER DEFAULT PRIVILEGES IN SCHEMA production REVOKE DELETE ON TABLES FROM erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA project_management REVOKE DELETE ON TABLES FROM erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA mrp REVOKE DELETE ON TABLES FROM erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA human_resources REVOKE DELETE ON TABLES FROM erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA sales REVOKE DELETE ON TABLES FROM erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA services REVOKE DELETE ON TABLES FROM erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA admin REVOKE DELETE ON TABLES FROM erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA management REVOKE DELETE ON TABLES FROM erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA accounting REVOKE DELETE ON TABLES FROM erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA finance REVOKE DELETE ON TABLES FROM erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA purchasing REVOKE DELETE ON TABLES FROM erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA operations REVOKE DELETE ON TABLES FROM erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA inventory REVOKE DELETE ON TABLES FROM erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA distribution REVOKE DELETE ON TABLES FROM erp_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA solution_customizing REVOKE DELETE ON TABLES FROM erp_user;

-- To be automatically become an erp_user
SET ROLE postgres;

-- To check current role
SELECT current_user; 
